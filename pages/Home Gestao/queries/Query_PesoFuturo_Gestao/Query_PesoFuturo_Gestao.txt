WITH pesos_por_data AS (
  SELECT 
    h.data::date AS dia,
    AVG(h.peso_dia) AS peso_medio
  FROM public.vw_locais_com_horarios h
  WHERE
    h.nome = ANY ({{ Select_Lojas.selectedOptionValues }})
    AND h.data::date >= {{ DatePicker_Inicial.selectedDate }}::date
    AND h.data::date <= {{ DatePicker_Final.selectedDate }}::date
  GROUP BY h.data::date
)
SELECT ROUND(COALESCE(SUM(CASE WHEN dia > current_date THEN peso_medio ELSE 0 END), 0), 2) AS total_peso_futuro;