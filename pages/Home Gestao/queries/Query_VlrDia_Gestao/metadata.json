{
  "gitSyncId": "68750378005e0954974296b0_c91d7514-592b-4478-8326-84419de5cb1f",
  "id": "Home Gestao_Query_VlrDia_Gestao",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH vendas_filtradas AS (\n  SELECT \n    valor_liquido,\n    data_lanca,\n    ponto_venda\n  FROM public.vw_faturamento_vendas_analitico\n  WHERE DATE_TRUNC('month', data_lanca) = '{{ Select_Mes.selectedOptionValue }}'::date\n    AND ponto_venda = ANY ({{ Select_Lojas.selectedOptionValues }})\n),\nultima_data_venda AS (\n  SELECT \n    MAX(data_lanca) AS ultima_data,\n    SUM(valor_liquido) AS total_vendido\n  FROM vendas_filtradas\n),\nsoma_pesos AS (\n  SELECT \n    SUM(peso_dia) AS total_peso\n  FROM public.vw_horarios_funcionamento_com_local\n  WHERE data <= (SELECT ultima_data FROM ultima_data_venda)\n    AND nome_loja = ANY ({{ appsmith.store.pontos_venda }})\n)\nSELECT \n  ROUND((udv.total_vendido / NULLIF(sp.total_peso, 0))::numeric, 2) AS valor_dia\nFROM ultima_data_venda udv\nJOIN soma_pesos sp ON true;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "BD DUAS",
      "isAutoGenerated": false,
      "name": "BD DUAS",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "Query_VlrDia_Gestao",
    "pageId": "Home Gestao",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}