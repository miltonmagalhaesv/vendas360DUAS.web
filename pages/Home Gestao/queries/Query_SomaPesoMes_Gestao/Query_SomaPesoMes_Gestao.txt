WITH pesos_por_data AS (
  SELECT 
    data,
    AVG(peso_dia) AS peso_medio
  FROM public.vw_locais_com_horarios
  WHERE nome = ANY ({{ Select_Lojas.selectedOptionValues }})
    AND data = '{{ DatePicker_Inicial.selectedDate }}'
  AND data = '{{ DatePicker_Final.selectedDate }}'
    AND data <= CURRENT_DATE
  GROUP BY data
)
SELECT 
  ROUND(SUM(peso_medio), 2) AS total_peso_mes
FROM pesos_por_data;