{
  "gitSyncId": "68750378005e0954974296b0_9a40ba04-9375-4c80-9595-2c39f2cbebe4",
  "id": "Cadastro Vendedor_insertVendedor",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH base AS (\n  -- monta o username base: primeiro nome + Ãºltimo sobrenome\n  SELECT\n    lower(\n      regexp_replace({{ InputNome.text }}, '\\s.*$', '') || '.' ||\n      regexp_replace({{ InputSobrenome.text }}, '^.*\\s', '')\n    ) AS base_username\n),\nnumero_existentes AS (\n  -- conta quantos usernames jÃ¡ existem com esse prefixo\n  SELECT\n    COUNT(*)::int AS qnt\n  FROM rh.colaboradores c\n  JOIN base b\n    ON c.nome_usuario LIKE b.base_username || '%'\n),\nusuario_final AS (\n  SELECT\n    b.base_username ||\n    CASE \n      WHEN n.qnt = 0 THEN ''            -- monica.santo\n      ELSE n.qnt::text                  -- monica.santo1, .2, etc\n    END AS nome_usuario\n  FROM base b\n  CROSS JOIN numero_existentes n\n)\nINSERT INTO rh.colaboradores (\n  nome,\n  sobrenome,\n  nome_vendedor,\n  nome_usuario,\n  email,\n  status,\n  cargo,\n  senha_hash\n)\nSELECT\n  {{ InputNome.text }}         AS nome,\n  {{ InputSobrenome.text }}    AS sobrenome,\n  {{ InputNomeVendedor.text }} AS nome_vendedor,\n  u.nome_usuario               AS nome_usuario,\n  u.nome_usuario || '@duas-temp.local' AS email,   -- ðŸ‘ˆ e-mail gerado automaticamente\n  'ativo'                      AS status,\n  'Vendedor'                   AS cargo,\n  '1234'                       AS senha_hash\nFROM usuario_final u\nRETURNING id, nome, sobrenome, nome_vendedor, nome_usuario;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "BD DUAS",
      "isAutoGenerated": false,
      "name": "BD DUAS",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "insertVendedor",
    "pageId": "Cadastro Vendedor",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": true
  }
}