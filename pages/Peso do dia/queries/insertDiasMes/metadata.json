{
  "gitSyncId": "68750378005e0954974296b0_2ddac6ac-1ad5-4e6b-8c0b-135ca998cb95",
  "id": "Peso do dia_insertDiasMes",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH dias_do_mes AS (\n  SELECT \n    generate_series(\n      date_trunc('month', to_date({{ Select_Mes.selectedOptionValue }}, 'YYYY-MM')),\n      date_trunc('month', to_date({{ Select_Mes.selectedOptionValue }}, 'YYYY-MM')) + interval '1 month' - interval '1 day',\n      interval '1 day'\n    )::date AS data\n),\ndados_com_peso AS (\n  SELECT \n    d.data,\n    EXTRACT(DOW FROM d.data) AS dia_semana,\n    {{ Select_PDV.selectedOptionValue }} AS local_id,\n    CASE\n      -- DUAS PLAZA (id = 3) → domingos 0.5\n      WHEN {{ Select_PDV.selectedOptionValue }} = 3 AND EXTRACT(DOW FROM d.data) = 0 THEN 0.5\n      WHEN {{ Select_PDV.selectedOptionValue }} = 3 THEN 1\n\n      -- DUAS SITE (id = 7) → todos os dias 1\n      WHEN {{ Select_PDV.selectedOptionValue }} = 7 THEN 1\n\n      -- DUAS ESPINHEIRO (id = 2) → domingos 0\n      WHEN {{ Select_PDV.selectedOptionValue }} = 2 AND EXTRACT(DOW FROM d.data) = 0 THEN 0\n      WHEN {{ Select_PDV.selectedOptionValue }} = 2 THEN 1\n\n      ELSE 1 -- default\n    END AS peso\n  FROM dias_do_mes d\n)\nINSERT INTO public.horarios_funcionamento (\n  local_trabalho_id, data, abre, fecha, aberto, peso_dia, atualizado_em\n)\nSELECT \n  local_id,\n  data,\n  '08:00',\n  '18:00',\n  TRUE,\n  peso,\n  now()\nFROM dados_com_peso;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "BD DUAS",
      "isAutoGenerated": false,
      "name": "BD DUAS",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "insertDiasMes",
    "pageId": "Peso do dia",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}