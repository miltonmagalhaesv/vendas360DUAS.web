WITH dias_do_mes AS (
  SELECT 
    generate_series(
      date_trunc('month', to_date({{ Select_Mes.selectedOptionValue }}, 'YYYY-MM')),
      date_trunc('month', to_date({{ Select_Mes.selectedOptionValue }}, 'YYYY-MM')) + interval '1 month' - interval '1 day',
      interval '1 day'
    )::date AS data
),
dados_com_peso AS (
  SELECT 
    d.data,
    EXTRACT(DOW FROM d.data) AS dia_semana,
    {{ Select_PDV.selectedOptionValue }} AS local_id,
    CASE
      -- DUAS PLAZA (id = 3) → domingos 0.5
      WHEN {{ Select_PDV.selectedOptionValue }} = 3 AND EXTRACT(DOW FROM d.data) = 0 THEN 0.5
      WHEN {{ Select_PDV.selectedOptionValue }} = 3 THEN 1

      -- DUAS SITE (id = 7) → todos os dias 1
      WHEN {{ Select_PDV.selectedOptionValue }} = 7 THEN 1

      -- DUAS ESPINHEIRO (id = 2) → domingos 0
      WHEN {{ Select_PDV.selectedOptionValue }} = 2 AND EXTRACT(DOW FROM d.data) = 0 THEN 0
      WHEN {{ Select_PDV.selectedOptionValue }} = 2 THEN 1

      ELSE 1 -- default
    END AS peso
  FROM dias_do_mes d
)
INSERT INTO public.horarios_funcionamento (
  local_trabalho_id, data, abre, fecha, aberto, peso_dia, atualizado_em
)
SELECT 
  local_id,
  data,
  '08:00',
  '18:00',
  TRUE,
  peso,
  now()
FROM dados_com_peso;